# φ-NTT：「桁ごとに独立した」整数変換が生み出す新しい信号処理の形

*論文 "φ-NTT: A Carry-Free Transform on Z₁₀^B with Hierarchical Wavelet Structure" の要約*

---

## 何を作ったのか

FFT（高速フーリエ変換）は音声・画像・通信の基盤技術ですが、内部で「複素数の小数演算」を使うため、わずかな丸め誤差が避けられません。

**φ-NTT** は、その代替となる変換です。特徴はシンプルです——**すべての計算が整数のまま、誤差ゼロで完結します。**

使う数は `Z[φ] = Z[√5]`、いわゆる「黄金比整数環」の元素です。`(a, b)` という整数ペアで `a + b·φ` を表し、乗算も `(a,b)·(c,d) = (ac+bd, ad+bc+bd)` という整数計算だけで済みます。

---

## 鍵となるアイデア：「桁ごとに独立した演算」

通常の数では `19 + 1 = 20`——1の位から10の位へ **繰り上がり（carry）** が発生します。

φ-NTT が扱う世界では、この繰り上がりを**禁止**します。各桁は完全に独立して `mod 10` で計算されます。

```
通常:   (9 + 1) = 10  → 1の位:0、10の位:1（繰り上がりあり）
carry-free: (9 + 1) mod 10 = 0  → 1の位:0のまま（繰り上がりなし）
```

一見すると奇妙な設定ですが、**この構造があるからこそ、FFTで言う「段間の位相補正（twiddle factor）」が一切不要になります。** B段の再帰を積み上げても、余計な補正係数がゼロ個——これが整数計算だけで完結できる根拠です。

---

## フィルタバンクとウェーブレット構造

B桁の信号（長さ10^B）を変換すると、**2^B個のチャネル**に分解されます。各チャネルには `{T, U}` の記号B個からなるラベルが付きます（例：B=3なら `TTT`, `TUT`, `UUU` など8種）。

- **T チャネル**：各桁の「滑らかな成分」を抽出（低域フィルタに相当）
- **U チャネル**：各桁の「偶奇の振動成分」を抽出（高域フィルタに相当）

この構造は、**Haarウェーブレット**の多重解像度解析と同型の二分木を形成します。桁階層が解像度階層に対応するのです。

| 性質 | Haar MRA | φ-NTT |
|------|----------|-------|
| 信号長 | 2^B | 10^B |
| チャネル数 | 2^B | 2^B |
| 近似係数 | スケール関数 | TT…T チャネル |
| 詳細係数 | ウェーブレット | T…TU_bT…T チャネル |
| 演算 | 実数（±1基底） | Z[φ]（黄金比整数環） |

---

## スペクトル集中：エネルギーはどこに行くか

周期100の信号（sin(2πn/100)）を変換すると、エネルギーはほぼ特定のチャネルに集中します。

| B | 1位チャネル | エネルギー | 上位3チャネル合計 |
|---|-----------|-----------|----------------|
| 3 | TUT | 86.4% | 99.8% |
| 4 | TUTT | 68.7% | 98.1% |
| 5 | TUTTT | 68.2% | 97.6% |

なぜ `TUT…T`（b=1の桁だけU）が最大なのか。周期100の信号は「10の位 d₁ の変化」に主に依存します。Uチャネルはその桁の偶奇を抽出する操作なので、d₁ に振動がある信号では b=1 の U が最も相関を持ちます——**桁と周波数の対応則**です。

この現象を形式化したのが**スペクトル集中準定理**です：

> 周期 P ≈ 2·10^b の信号に対して、b段目のdetailチャネルが捉えるエネルギー比は α_b ≥ C·(1−ε)^{B−1} を満たす。

---

## 何が保証されているか

- **完全可逆**：全チャネルを保持すれば、元の信号を整数誤差ゼロで復元（スケール因子 40^B または 80^B で正確に割り切れることが保証されている）
- **畳み込み定理**：通常のFFTと同様に、チャネル領域での積が carry-free 畳み込みに対応する
- **B=1〜5で検証済み**：長さ10〜100,000の信号で δ畳み込みテスト全通過

---

## 未解決の問題

1. **T/U の直交性**：数値的には確認済みだが、Z[φ] 上での代数的証明は未完了
2. **定数 C と ε の閉形式**：現状は観測値からの逆算
3. **通常の畳み込みとの接続**：carry-free でない一般的な整数信号への応用（overlap-add 経由）

---

## まとめ

φ-NTT は「桁ごとの独立性」という一点から出発し、整数だけで動く変換・畳み込み・ウェーブレット分解を一貫した代数構造として導出します。FFTや従来のNTTとは異なる群（Z₁₀^B）の上に定義されており、両者とは置き換え不可能な独自の演算体系です。

---

*実装: `phi_carry_free.py` / 引継書 v2〜v12 (2026-02-25)*
