## 仕様セクション：H-Carrier（有用残差再注入）伝播と安定制御

### 概要
本プロセッサは、ユニット内部で発生する残差（排熱）Hを単なる損失として捨てず、
次段（または次ステップ）のしきい値・結合係数・減衰率に対する **適応型バイアス** として再利用する。
ただし、Hの無条件再注入はフィードバック発振・ドリフト・飽和を招くため、
以下の3つのガードレール（安定条件）を **I/O仕様として必須** とする。

---

### 1. Hの有用性保証（Threshold Gate）

**目的**：微小な定常ノイズ（量子化誤差・熱雑音相当）を循環させず、信号の急変（エッジ）に対応する有用残差のみをキャリアする。

**定義（分解）**：
- H_s：符号付き残差（signed residual）
- H_m：残差強度（magnitude / energy）

例（1サンプル/1タイルいずれでも可）：
- H_s := mean(heat)  または  sum(heat)
- H_m := mean(|heat|) または sum(|heat|) または sqrt(sum(heat^2))

**閾値ゲート**：
ユニット固有のノイズフロアを閾値 τ とし、H_m が τ を超える場合のみ再注入を許可する。

- ゲート係数：
  - g := clip((H_m - τ) / κ, 0, 1)  
    （κ はゲートの立ち上がり幅。κ→0 で hard gate、κ>0 で soft gate）

**再注入バイアス（基本形）**：
- b := α · g · H_s

**備考（推奨）**：
- τ は「量子化誤差相当」＋「環境雑音下の安全マージン」で設定する。
- L/R交差注入に用いる場合、Hは差分残差（differential residual）として構成し、common-mode成分を抑制する。

---

### 2. リーク積分によるドリフト防止（Leaky Integration）

**目的**：Hの再注入が蓄積してDCオフセット化し、飽和・偏り・環境変化への追従遅れを起こすことを防ぐ。

**リーク付き蓄積**：
- Ĥ_s[t] := (1 - λ) · Ĥ_s[t-1] + λ · H_s[t]  
  （0 < λ ≤ 1）

同様に強度側も必要なら：
- Ĥ_m[t] := (1 - λ_m) · Ĥ_m[t-1] + λ_m · H_m[t]

**再注入**：
- b[t] := α · g[t] · Ĥ_s[t]

**仕様パラメータ**：
- λ（リーク係数）：忘却の速さ（時間定数）  
  - λ が小さいほど「ゆっくり適応」、大きいほど「素早く適応」
- 設計ルール（推奨）：ユースケースに応じて λ を定め、急変ノイズ環境でドリフトしないことを確認する。

---

### 3. ループ利得の拘束（Stability Loop-Gain Constraint）

**目的**：H-Carrier再注入が正帰還として暴走することを防ぎ、全入力条件で実用上の安定を担保する。

**基本制約（十分条件）**：
再注入の実効ループ利得を 1 未満に拘束する。

- 実効利得：
  - G_eff := |α| · g_max · C
  - 要件：G_eff < 1

ここで、
- α：再注入利得（設計パラメータ）
- g_max：ゲート係数の最大値（通常 1）
- C：ユニットの結合増幅係数（トポロジーと更新則に依存する上界）

**逆フィボナッチ収束係数との相関（推奨）**：
本系は収束更新で INV_PHI = φ^{-1} を用いるため、保守的には以下を推奨する：

- |α| ≤ (1 - INV_PHI) · β  
  （0 < β < 1 は安全率。例：β=0.5〜0.9）

直観：
- INV_PHI が大きい（収束が弱い）ほど、α を小さくする必要がある。
- 収束が強いほど、H-Carrierを許容できる。

**実装上の注意**：
- 飽和（clip）を必須とし、バイアスbの上限 |b| ≤ b_max を設ける。
- ユニット間交差注入（L↔R）の場合、帯域/モード限定（または差分残差化）と組み合わせる。

---

### I/O仕様（最小セット）

各ユニットは以下の3出力を持つ：

- y_I, y_Q：主信号（I/Qまたは2相当成分）
- H_s, H_m：残差（符号付き／強度）

H-Carrier再注入を有効化する場合、上記 1〜3 の条件を満たすこと。
満たさない場合、Hは「観測専用（診断ポート）」として扱う。

---

### 用語（短縮）
- H（heat）：残差/排熱。単なる損失ではなく、未整定成分の情報キャリア。
- H-Carrier：Hを次段・次ステップのバイアスとして運ぶ仕組み。
- g（gate）：有用残差のみ通すフィルタ係数。
- λ（leak）：過去残差を忘却する係数（ドリフト防止）。
- α（gain）：再注入強度（ループ利得を決める）。
